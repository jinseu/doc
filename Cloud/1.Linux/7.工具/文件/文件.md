### df/du

du的工作原理

du命令会对待统计文件逐个调用fstat这个系统调用，获取文件大小。它的数据是基于文件获取的，所以有很大的灵活性，不一定非要针对一个分区，可以跨越多个分区操作。如果针对的目录中文件很多，du速度就会很慢了。

df的工作原理

df命令使用的事statfs这个系统调用，直接读取分区的超级块信息获取分区使用情况。它的数据是基于分区元数据的，所以只能针对整个分区。由于df直接读取超级块，所以运行速度不受文件多少影响。

du和df不一致情况模拟

常见的df和du不一致情况就是文件删除的问题。当一个文件被删除后，在文件系统 目录中已经不可见了，所以du就不会再统计它了。然而如果此时还有运行的进程持有这个已经被删除了的文件的句柄，那么这个文件就不会真正在磁>盘中被删除， 分区超级块中的信息也就不会更改。这样df仍旧会统计这个被删除了的文件。

#### 参数说明

```
df -i 显示inode占用率
df -T 可以显示文件系统的类型
du -s 参数可以仅仅显示该目录下的总大小
```

### chown

### chmod

lsattr

linux下文件还有一些隐藏属性，可以用lsattr来查看和更改

SUID：其他用户在执行该文件时，以其拥有者的身份来执行该文件。

- SUID权限仅对二进制可执行文件有效
- 执行者对于该文件具有x的权限
- 本权限仅在执行该文件的过程中有效
- 执行者将具有该文件拥有者的权限

     -rwsr-xr-x 1 root root 54192 11月 18  2015 /usr/bin/passwd

SGID和SUID的定义类似，只不过将权限限定在了该文件所属的用户组的权限。

Sticky权限

- 只能设置在目录上
- 任何用户都有权创建和修改文件，但是只有文件的owner和root用户才有权限可以删除文件。
- 如果同时设置了x权限，则显示T，否则显示t。
- 可以使用 chmod +t /usr/local/tmp或chmod 1777 /usr/local/tmp

    drwxrwxrwt  4 root root  133 8月   4 14:38 tmp

权限对目录的意义

1. r权限：拥有此权限表示可以读取目录结构列表，也就是说可以查看目录下的文件名和子目录名，注意：仅仅指的是名字。
2. w权限：拥有此权限表示具有更改该目录结构列表的权限，总之，目录的w权限与该目录下的文件名或子目录名的变动有关，注意：指的是名字。具体如下：
 - 在该目录下新建新的文件或子目录。
 - 删除该目录下已经存在的文件或子目录（不论该文件或子目录的权限如何），注意：这点很重要，用户能否删除一个文件或目录，看的是该用户是否具有该文件或目录所在的目录的w权限。
 - 将该目录下已经存在的文件或子目录进行重命名。
 - 转移该目录内的文件或子目录的位置。
3. x权限：拥有目录的x权限表示用户可以进入该目录成为工作目录，能不能进入一个目录，只与该目录的x权限有关，如果用户对于某个目录不具有x权限，则无法切换到该目录下，也就无法执行该目录下的任何命令，即使具有该目>录的r权限。且如果用户对于某目录不具有x权限，则该用户不能查询该目录下的文件的内容，注意：指的是内容，如果有r 权限是可以查看该目录下的文件名列表或子目录列表的。所以要开放目录给任何人浏览时，应该至少要给与r>及x权限。

样例

    #更改权限的实例
    chmod u=rwx g=rw o=r filename
    #递归更改
    chmod 777 . -R



### find

命令格式

```
find [-H] [-L] [-P] [-D debugopts] [-Olevel] [path...] [expression]
```

#### 参数列表

1. `-name` 根据文件名进行查找
2. `-iname` 根据文件名进行查找，并忽略大小写
3. `-o`  表示条件之间是or关系
4. `-path` 匹配文件路径
5. `-regex` 根据正则表达式来匹配路径
6. `!`否定参数，例如`! -name ".txt"` 找到所有不以txt结尾的文件名
7. `-maxdepth` 最大递归深度
8. `-mindepth` 最小递归深度
9. `-atime {n} -mtime {n} -ctime {n}` 按照文件被读取或者执行的时间、文件内容修改时间、文件的i结点被修改的时间查找，n整数单位为天。-表示小于，+表示大于，无符号则表示恰好在该天修改的。
10. `-amin {n} -mmin {n} -cmin {n}` 按照修改时间查找，整数，单位为分钟
11. `-anewer -cnewer -newer` 按照访问时间找到比某个文件更新的文件
12. `-size` 按照大小查找 -表示小于，+表示大于，无符号则表示恰好这么大。可以使用的单位包括b,c,w,k,M,G
13. `-user`   按照文件所有权进行查找
14. `-exec`  可以对查询结果，执行其他命令。

#### 1. find能根据哪些条件来查找文件

文件名，文件权限，用户名，修改时间，访问时间（访问时间是文件最后一次被读取的时间），创建时间（文件元数据最后一次被更改的时间），类型，大小，目录的深度，inode

常见的type有 b（块文件） d（目录） c（字符文件） p（管道文件） l（链接） f（普通文件） s（socket文件）

#### 2. find能否根据文件内容来检索

不可以，本身只是根据文件的属性进行查找的

#### 3. find删除找到的文件的

```
#删除查找到的文件
find . -name "*.md" -delete
find . -name "*.dump" | xargs rm -f
find . -type f -name "*.dump" -exec rm -f '{}' \;
#查找后缀为txt或pdf的文件
find . \( -name "*.txt" -o -name "*.pdf"\)
#找到比file.txt更新的文件
find . -type f -newer file.txt
#跳过指定的目录
find . \( -name ".git" -prune \) -o \( -type f \)
```
    
#### 4. find找到目录的最大深度

```
find /home/kiva/cephfs/var/ -type d -printf '%d %p\n' | sort -rn | head -1
```

### ln

Liunux 硬链接允许一个文件拥有多个有效的路径名，这样用户就可以建立硬链接指向同一个文件。即多个文件指向同一个inode，删除一个链接并不会影响索引节点本身和其他链接，只有当所有与之相关的连接被删除后，该文件才会
被删除。

硬链接有两个限制：
- 不允许给目录创建硬链接（目录环）
- 只有在同一文件系统中的文件之间才能建立硬链接（inode 号仅在各文件系统下是唯一的，当 Linux 挂载多个文件系统后将出现 inode 号重复的现象，因此硬链接创建时不可跨文件系统）
- 不能对不存在的文件创建硬链接

软连接（符号链接）

- 软链接有自己的文件属性及权限等；
- 可对不存在的文件或目录创建软链接；
- 软链接可交叉文件系统；
- 软链接可对文件或目录创建；
- 创建软链接时，链接计数 i_nlink 不会增加；
- 删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。

https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/

### ls

-i 打印出inode
-R 打印出子目录

默认根据name排序，可以根据--sort=WORD来改变，包括 size (-S), time (-t), version (-v), extension (-X)
ls 命令中的第二行指连接数，

ls -lc filename         列出文件的 ctime
ls -lu filename         列出文件的 atime
ls -l filename          列出文件的 mtime

关于inode

https://www.ibm.com/developerworks/cn/aix/library/au-speakingunix14/

### 分区

IDE 驱动器上有三种类型的分区：主分区、逻辑分区 和扩展分区。分区表 位于磁盘主引导记录 (MBR) 之中。分区表 位于磁盘主引导记录 (MBR) 中。MBR 是磁盘上的第一个扇区，因而分区表在其中所占空间不大。这限制了一个磁盘上的主分区数量，最多为 4 个。如果需要 4 个以上的主分区（往往需要 4 个以上的主分区），其中一个主分区就必须以扩展分区的形式出现。扩展分区是一个或多个逻辑分区的容器。这样，在一个使用 MBR 布局的驱动器上就可以有4 个以上的分区。

#### a. LVM

LVM利用Linux内核的device-mapper来实现存储系统的虚拟化（系统分区独立于底层硬件）。 通过LVM，你可以实现存储空间的抽象化并在上面建立虚拟分区（virtual partitions），可以更简便地扩大和缩小分区，可以增删分区时无需担心某个硬盘上没有足够的连续空间。LVM由以下四部分构成：
物理卷Physical volume (PV)：可以在上面建立卷组的媒介，可以是硬盘分区，也可以是硬盘本身或者回环文件（loopback file）。物理卷包括一个特殊的header，其余部分被切割为一块块物理区域（physical extents）。
卷组Volume group (VG)：将一组物理卷收集为一个管理单元。
逻辑卷Logical volume (LV)：虚拟分区，由物理区域（physical extents）组成。
物理区域Physical extent (PE)：硬盘可供指派给逻辑卷的最小单位（通常为4MB）。

诸如 mkfs 和 mount 文件系统命令使用 /dev/<vg-name>/<lv-name> 这样的名称访问 LV。
vgcreate，lvcreate可以分别创建vg和lv

### convmv

转换文件目录编码

```
convmv -f 源编码 -t 新编码 [选项] 文件名
```

常用参数：

```
-r 递归处理子文件夹
--notest 真正进行操作，请注意在默认情况下是不对文件进行真实操作的，而只是试验。
--list 显示所有支持的编码
--unescap 可以做一下转义，比如把%20变成空格
```

样例

```
convmv -f UTF-8 -t GBK -r --notest ./var
```


### tar

**制作tar包**

```
tar -zcvf NVIDIA-Driver.450.80.tar ./NVIDIA-Driver.450.80
```

1. -z : Compress archive using gzip program in Linux or Unix
1. -c : Create archive on Linux
1. -v : Verbose i.e display progress while creating archive
1. -f : Archive File name

**解压tar包**

```
```